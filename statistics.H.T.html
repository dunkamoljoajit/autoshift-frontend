<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUTONURSESHIFT - ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡∏°</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="components.js"></script> 

    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            background-color: #f7fafc; 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed;  
        }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
        .modal-active { overflow: hidden; }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
        
        #monthSelect { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); }
        #yearSelect { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234338ca' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); }

        .shift-log-container::-webkit-scrollbar { width: 4px; }
        .shift-log-container::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>

<body class="text-gray-800 bg-slate-50">
<div class="flex flex-col h-screen relative">

    <app-header class="fixed top-0 left-0 w-full z-50"></app-header> 

    <main class="flex-1 overflow-y-auto pb-28 pt-16">
        <div class="max-w-screen-md mx-auto p-4 space-y-6">
            
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-2">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-chart-bar text-indigo-600"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                </h2>
                
                <div class="flex gap-2 self-end sm:self-auto">
                    <select id="monthSelect" onchange="changeFilter()" class="bg-indigo-600 text-white text-sm font-medium px-4 py-2 rounded-xl shadow-md outline-none cursor-pointer hover:bg-indigo-700 transition border border-indigo-500 min-w-[120px]">
                    </select>
            
                    <select id="yearSelect" onchange="changeFilter()" class="bg-white text-indigo-700 text-sm font-bold px-4 py-2 rounded-xl shadow-md outline-none cursor-pointer hover:bg-gray-50 transition border border-indigo-100 min-w-[100px]">
                    </select>
                </div>
            </div>

            <div class="bg-indigo-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden transition-all hover:shadow-2xl">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-indigo-500 rounded-full blur-3xl opacity-20"></div>
                
                <div class="relative z-10 flex justify-between items-start">
                    <div>
                        <p class="text-indigo-200 text-xs font-light">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏≠‡∏£‡πå‡∏î ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô<span id="displayMonthName" class="font-bold ml-1">-</span></p>
                        <h3 class="text-4xl font-bold mt-1"><span id="totalWardShifts">0</span> <span class="text-sm font-normal opacity-60">‡πÄ‡∏ß‡∏£</span></h3>
                    </div>
                    <div class="w-12 h-12 bg-white/10 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <i class="fas fa-users text-2xl opacity-80"></i>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-3 mt-6 relative z-10">
                    <div class="bg-white/10 p-3 rounded-xl text-center border border-white/5 backdrop-blur-sm">
                        <p class="text-xs text-orange-300 font-bold mb-1">‡πÄ‡∏ä‡πâ‡∏≤</p>
                        <p id="totalM" class="text-2xl font-black">0</p>
                    </div>
                    <div class="bg-white/10 p-3 rounded-xl text-center border border-white/5 backdrop-blur-sm">
                        <p class="text-xs text-sky-300 font-bold mb-1">‡∏ö‡πà‡∏≤‡∏¢</p>
                        <p id="totalA" class="text-2xl font-black">0</p>
                    </div>
                    <div class="bg-white/10 p-3 rounded-xl text-center border border-white/5 backdrop-blur-sm">
                        <p class="text-xs text-indigo-300 font-bold mb-1">‡∏î‡∏∂‡∏Å</p>
                        <p id="totalN" class="text-2xl font-black">0</p>
                    </div>
                </div>
            </div>

            <div id="nurseListContainer" class="space-y-3 min-h-[200px]">
                <div class="flex flex-col items-center justify-center h-40 text-gray-400">
                    <i class="fas fa-circle-notch fa-spin text-2xl mb-2"></i>
                    <p class="text-xs">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            </div>

            <button onclick="exportToExcel()" class="w-full py-4 bg-white text-indigo-600 border border-indigo-100 rounded-2xl font-bold text-sm shadow-sm hover:bg-indigo-50 transition-all flex items-center justify-center gap-2">
                <i class="fas fa-file-excel text-green-600"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)
            </button>
        </div>
    </main>

    <app-navbar class="fixed bottom-0 left-0 w-full z-50"></app-navbar>

    <div id="nurseModal" class="fixed inset-0 z-[60] hidden flex items-end justify-center sm:items-center">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="relative w-full max-w-screen-md bg-white rounded-t-[2.5rem] sm:rounded-[2rem] shadow-2xl transform translate-y-full transition-transform duration-300 flex flex-col h-[85vh] sm:h-auto sm:max-h-[85vh]" id="modalContent">
            
            <div class="p-6 pb-0 flex-none">
                <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6 sm:hidden"></div>
                
                <div class="flex items-center gap-4 mb-6">
                    <img id="modalImg" src="" class="w-16 h-16 rounded-2xl shadow-md border-2 border-white bg-gray-100 object-cover">
                    <div>
                        <h3 id="modalName" class="text-xl font-bold text-gray-800"></h3>
                        <p id="modalStatus" class="text-sm font-medium"></p>
                    </div>
                    <button onclick="closeModal()" class="ml-auto w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div class="bg-orange-50 p-3 rounded-2xl text-center border border-orange-100">
                        <p class="text-orange-600 text-[10px] font-bold uppercase">‡πÄ‡∏ä‡πâ‡∏≤</p>
                        <p id="mShift" class="text-2xl font-bold text-orange-700">0</p>
                    </div>
                    <div class="bg-sky-50 p-3 rounded-2xl text-center border border-sky-100">
                        <p class="text-sky-600 text-[10px] font-bold uppercase">‡∏ö‡πà‡∏≤‡∏¢</p>
                        <p id="aShift" class="text-2xl font-bold text-sky-700">0</p>
                    </div>
                    <div class="bg-indigo-50 p-3 rounded-2xl text-center border border-indigo-100">
                        <p class="text-indigo-600 text-[10px] font-bold uppercase">‡∏î‡∏∂‡∏Å</p>
                        <p id="nShift" class="text-2xl font-bold text-indigo-700">0</p>
                    </div>
                </div>
                
                <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                    <i class="fas fa-calendar-day text-indigo-500"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ß‡∏£
                </h4>
            </div>

            <div class="flex-1 overflow-y-auto px-6 shift-log-container space-y-2 pb-6" id="shiftDateList"></div>

            <div class="p-6 border-t border-gray-100 bg-gray-50/50 rounded-b-[2.5rem] sm:rounded-b-[2rem] flex-none">
                <button onclick="closeModal()" class="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition-all hover:bg-indigo-700">
                    ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    const API_BASE_URL = 'https://autoshift-backend.onrender.com';
    let currentDataCache = null; 

    async function fetchData() {
        const yearTH = document.getElementById('yearSelector').value;
        const yearAD = parseInt(yearTH) - 543;
        const tbody = document.getElementById('monthlyShiftTableBody');
        tbody.innerHTML = `<tr><td colspan="5" class="text-center py-10"><i class="fas fa-circle-notch fa-spin text-indigo-400 text-lg"></i></td></tr>`;

        try {
            const userStr = localStorage.getItem('user');
            const token = localStorage.getItem('token');
            if (!userStr || !token) throw new Error("No Auth Token Found");

            const user = JSON.parse(userStr);
            const response = await fetch(`${API_URL}/api/my-stats`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json', 
                    'Authorization': `Bearer ${token}` 
                },
                body: JSON.stringify({ userId: user.UserID, year: yearAD })
            });

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Error ‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á Server
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `Server Error: ${response.status}`);
            }

            const result = await response.json();
            if (result.success) {
                fullYearDataCache = result.data;
                filterAndRender();
            }
        } catch (error) {
            console.error("Detailed Error:", error); // ‡∏î‡∏π Error ‡πÄ‡∏ï‡πá‡∏°‡πÜ ‡πÉ‡∏ô F12 Console
            tbody.innerHTML = `<tr><td colspan="5" class="text-center py-6 text-red-400">
                ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
            </td></tr>`;
        }
    }

    function renderDashboard(data) {
        currentDataCache = data;

        document.getElementById('displayMonthName').innerText = data.monthName;
        document.getElementById('totalWardShifts').innerText = data.wardTotal;
        document.getElementById('totalM').innerText = data.totalM;
        document.getElementById('totalA').innerText = data.totalA;
        document.getElementById('totalN').innerText = data.totalN;

        const container = document.getElementById('nurseListContainer');
        container.innerHTML = '<h3 class="text-sm font-bold text-gray-600 px-1 italic mb-2">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</h3>';

        if(data.nurses.length === 0) {
            container.innerHTML += '<div class="text-center text-gray-400 py-6">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>';
            return;
        }

        data.nurses.forEach(n => {
            const pM = n.total > 0 ? (n.m / n.total) * 100 : 0;
            const pA = n.total > 0 ? (n.a / n.total) * 100 : 0;
            const pN = n.total > 0 ? (n.n / n.total) * 100 : 0;
            const userImg = n.img ? n.img : `https://ui-avatars.com/api/?name=${n.name}&background=random&color=fff`;

            const div = document.createElement('div');
            div.className = "bg-white rounded-2xl p-4 shadow-sm border border-gray-100 space-y-3 cursor-pointer active:scale-95 transition-all mb-3 hover:shadow-md";
            div.onclick = () => openNurseDetails({...n, img: userImg}); 

            div.innerHTML = `
                <div class="flex items-center gap-3">
                    <img src="${userImg}" class="w-10 h-10 rounded-full border border-gray-100 object-cover">
                    <div class="flex-1">
                        <h4 class="text-sm font-bold text-gray-800">${n.name}</h4>
                        <p class="text-[10px] text-gray-400 uppercase tracking-wide flex items-center gap-2">
                            <span>‡πÄ‡∏ß‡∏£‡∏£‡∏ß‡∏°: <b class="text-gray-600">${n.total}</b></span>
                            <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                            <span class="${n.status === '‡∏õ‡∏Å‡∏ï‡∏¥' ? 'text-green-500' : 'text-orange-500'} font-bold">${n.status}</span>
                        </p>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </div>
                <div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden flex shadow-inner">
                    <div class="bg-orange-400" style="width:${pM}%"></div>
                    <div class="bg-sky-400" style="width:${pA}%"></div>
                    <div class="bg-indigo-600" style="width:${pN}%"></div>
                </div>`;
            container.appendChild(div);
        });
    }

    function changeFilter() {
        const month = document.getElementById('monthSelect').value;
        const year = document.getElementById('yearSelect').value;
        fetchData(year, month);
    }

    function openNurseDetails(n) {
        document.getElementById('modalName').innerText = n.name;
        document.getElementById('mShift').innerText = n.m;
        document.getElementById('aShift').innerText = n.a;
        document.getElementById('nShift').innerText = n.n;
        document.getElementById('modalImg').src = n.img;
        
        const statusEl = document.getElementById('modalStatus');
        statusEl.innerText = n.status;
        statusEl.className = 'text-sm font-bold ' + (n.status === '‡∏õ‡∏Å‡∏ï‡∏¥' ? 'text-green-600' : 'text-orange-500');
        
        const list = document.getElementById('shiftDateList');
        list.innerHTML = ''; 
        
        if (n.dates && n.dates.length > 0) {
            n.dates.forEach(shift => {
                let colorClass = "bg-gray-50 border-gray-100 text-gray-600";
                let dotClass = "bg-gray-400";
                if(shift.type.includes('‡πÄ‡∏ä‡πâ‡∏≤')) { colorClass = "bg-orange-50 border-orange-100 text-orange-700"; dotClass = "bg-orange-400"; }
                else if(shift.type.includes('‡∏ö‡πà‡∏≤‡∏¢')) { colorClass = "bg-sky-50 border-sky-100 text-sky-700"; dotClass = "bg-sky-400"; }
                else if(shift.type.includes('‡∏î‡∏∂‡∏Å')) { colorClass = "bg-indigo-50 border-indigo-100 text-indigo-700"; dotClass = "bg-indigo-600"; }

                const row = document.createElement('div');
                row.className = `flex justify-between items-center p-3 rounded-xl border ${colorClass} shadow-sm`;
                row.innerHTML = `
                    <div class="flex items-center gap-3 font-bold">
                        <div class="flex flex-col items-center justify-center bg-white w-10 h-10 rounded-lg shadow-sm border border-gray-100">
                             <span class="text-[8px] text-gray-400 uppercase">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                             <span class="text-lg leading-none text-gray-800">${shift.d}</span>
                        </div>
                        <div class="w-2 h-2 rounded-full ${dotClass}"></div>
                    </div>
                    <span class="text-sm font-black uppercase tracking-widest">${shift.type}</span>
                `;
                list.appendChild(row);
            });
        } else {
            list.innerHTML = '<div class="text-center text-gray-400 py-8 flex flex-col items-center"><i class="fas fa-coffee text-3xl mb-2 opacity-50"></i><span>‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ß‡∏£‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span></div>';
        }

        const modal = document.getElementById('nurseModal');
        const content = document.getElementById('modalContent');
        modal.classList.remove('hidden');
        setTimeout(() => content.classList.remove('translate-y-full'), 10);
        document.body.classList.add('modal-active');
    }

    function closeModal() {
        const content = document.getElementById('modalContent');
        content.classList.add('translate-y-full');
        setTimeout(() => {
            document.getElementById('nurseModal').classList.add('hidden');
            document.body.classList.remove('modal-active');
        }, 300);
    }

    // --- üü¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Export Excel (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á 100%) ---
    function exportToExcel() {
        if (!currentDataCache) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô");
            return;
        }

        const monthVal = document.getElementById('monthSelect').value;
        const yearVal = document.getElementById('yearSelect').value;
        const daysInMonth = new Date(yearVal, monthVal, 0).getDate(); 

        const headers = ["‡∏•‡∏≥‡∏î‡∏±‡∏ö", "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"];
        for (let i = 1; i <= daysInMonth; i++) {
            headers.push(String(i)); 
        }
        headers.push("‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏£", "‡πÄ‡∏ä‡πâ‡∏≤", "‡∏ö‡πà‡∏≤‡∏¢", "‡∏î‡∏∂‡∏Å");

        const rows = currentDataCache.nurses.map((n, index) => {
            let rowData = [index + 1, n.name, n.status];

            for (let d = 1; d <= daysInMonth; d++) {
                const dayStr = String(d).padStart(2, '0');
                const shift = n.dates.find(s => s.d === dayStr);
                
                if (shift) {
                    // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢/‡∏î‡∏∂‡∏Å ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    let shortName = shift.type; 
                    if (shift.type.includes('‡πÄ‡∏ß‡∏£‡πÄ‡∏ä‡πâ‡∏≤')) shortName = '‡∏ä';
                    else if (shift.type.includes('‡πÄ‡∏ß‡∏£‡∏ö‡πà‡∏≤‡∏¢')) shortName = '‡∏ö';
                    else if (shift.type.includes('‡πÄ‡∏ß‡∏£‡∏î‡∏∂‡∏Å')) shortName = '‡∏î';
                    
                    rowData.push(shortName);
                } else {
                    rowData.push("");
                }
            }

            rowData.push(n.total, n.m, n.a, n.n);
            return rowData;
        });

        const excelData = [
            ["‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•"],
            [`‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${currentDataCache.monthName}`],
            [],
            headers,
            ...rows
        ];

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(excelData);

        const wscols = [
            {wch: 5}, {wch: 25}, {wch: 10} 
        ];
        for(let i=0; i<daysInMonth; i++) wscols.push({wch: 3});
        wscols.push({wch: 8}, {wch: 6}, {wch: 6}, {wch: 6});
        
        ws['!cols'] = wscols;

        XLSX.utils.book_append_sheet(wb, ws, "Schedule");
        XLSX.writeFile(wb, `Nurse_Schedule_${yearVal}_${monthVal}.xlsx`);
    }

    window.onload = () => {
        const today = new Date();
        const currentMonth = today.getMonth() + 1;
        const currentYear = today.getFullYear();

        const monthSelect = document.getElementById('monthSelect');
        const thaiMonths = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];

        thaiMonths.forEach((name, index) => {
            const option = document.createElement('option');
            option.value = String(index + 1).padStart(2, '0');
            option.text = name;
            if (index + 1 === currentMonth) option.selected = true;
            monthSelect.appendChild(option);
        });

        const yearSelect = document.getElementById('yearSelect');
        for (let y = currentYear - 2; y <= currentYear + 1; y++) {
            const option = document.createElement('option');
            option.value = y;
            option.text = y + 543;
            if (y === currentYear) option.selected = true; 
            yearSelect.appendChild(option);
        }

        changeFilter();
    };
</script>
</body>
</html>