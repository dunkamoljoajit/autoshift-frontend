<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - AutoNurseShift</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/th.min.js"></script>
    <script src="components.js"></script> 

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .card-enter { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .clickable-card { cursor: pointer; transition: all 0.2s ease; position: relative; border-left-width: 4px !important; }
        .clickable-card:hover { transform: translateY(-2px); background-color: #f1f5f9; border-color: #6366f1; shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .clickable-card:active { transform: scale(0.98); }
    </style>
</head>
<body class="pb-24">

    <app-header class="fixed top-0 left-0 w-full z-50 shadow-sm bg-white"></app-header>

    <main class="pt-32 md:pt-44 max-w-2xl mx-auto px-4 py-6">
        
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-2xl font-bold text-slate-800">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
                <p class="text-slate-500 text-sm mt-1" id="page-subtitle">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            </div>
            <div class="bg-indigo-50 p-2.5 rounded-2xl">
                <i class="fas fa-bell text-indigo-600 text-xl"></i>
            </div>
        </div>

        <div class="mb-6 overflow-x-auto no-scrollbar">
            <div class="flex gap-2 min-w-max pb-2">
                <button onclick="filterNoti('all')" class="filter-btn active px-5 py-2 rounded-xl text-xs font-bold transition-all bg-indigo-600 text-white shadow-md">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button onclick="filterNoti('trade')" class="filter-btn px-5 py-2 rounded-xl text-xs font-bold transition-all bg-white border border-slate-200 text-slate-600 shadow-sm">üí∞ ‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</button>
                <button onclick="filterNoti('swap')" class="filter-btn px-5 py-2 rounded-xl text-xs font-bold transition-all bg-white border border-slate-200 text-slate-600 shadow-sm">üîÑ ‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏ß‡∏£</button>
                <button onclick="filterNoti('system')" class="filter-btn px-5 py-2 rounded-xl text-xs font-bold transition-all bg-white border border-slate-200 text-slate-600 shadow-sm">üì¢ ‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>

        <div id="notificationList" class="space-y-4 min-h-[300px]"></div>

        <div id="loading" class="hidden flex flex-col items-center py-20">
            <div class="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-3"></div>
            <span class="text-slate-400 text-xs">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
        </div>
        
        <div id="emptyState" class="hidden flex flex-col items-center py-24 text-center">
            <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-check-circle text-3xl text-slate-200"></i>
            </div>
            <h3 class="text-slate-600 font-bold">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
        </div>

    </main>

    <app-navbar></app-navbar>

    <script>
        const API_URL = (typeof API_BASE !== 'undefined') ? API_BASE : 'https://autoshift-backend.onrender.com';
        let currentUser = null;
        let allNotifications = [];
        let isFetching = false; // ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô

        document.addEventListener('DOMContentLoaded', async () => {
            moment.locale('th'); 
            const userStr = localStorage.getItem('user');
            if (!userStr) { window.location.href = 'login.html'; return; }
            currentUser = JSON.parse(userStr);
            
            if (currentUser.RoleID === 1) {
                document.getElementById('page-subtitle').innerText = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                await fetchAdminPendingActions(); 
            }
            
            // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
            await loadNotifications();
            
            // ‚úÖ Mark Read ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
            markAllAsRead(); 
            
            initSocket();
        });

    

        async function loadNotifications() {
            if (isFetching) return; 
            isFetching = true;

            const loader = document.getElementById('loading');
            const token = localStorage.getItem('token');
            loader.classList.remove('hidden');

            try {
                const res = await fetch(`${API_URL}/api/notifications/all/${currentUser.UserID}`, { 
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                const data = await res.json();
                
                if (data.success) {
                    allNotifications = data.notifications;
                    renderList(allNotifications);
                    // ‚ùå ‡∏¢‡πâ‡∏≤‡∏¢ fetch(mark-all-read) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£ Loop
                }
            } catch (err) { 
                console.error("Load Notifications Error:", err);
            } finally {
                isFetching = false;
                loader.classList.add('hidden');
            }
        }

        async function markAllAsRead() {
            const token = localStorage.getItem('token');
            try {
                // ‡∏¢‡∏¥‡∏á API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß
                await fetch(`${API_URL}/api/notifications/mark-all-read`, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, 
                    body: JSON.stringify({ userId: currentUser.UserID }) 
                });
            } catch(err) {
                console.error("Mark Read Error:", err);
            }
        }

        function renderList(data) {
            const list = document.getElementById('notificationList');
            const empty = document.getElementById('emptyState');
            
            const adminCards = Array.from(list.querySelectorAll('[id^="admin-card-"]'));
            list.innerHTML = '';
            adminCards.forEach(card => list.appendChild(card));
            
            if ((!data || data.length === 0) && adminCards.length === 0) { 
                empty.classList.remove('hidden'); 
                return; 
            }
            empty.classList.add('hidden');

            data.forEach((noti, index) => {
                let info = noti.info || '';
                const title = noti.Title || '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
                
                // ‚úÖ [‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á] ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤‡∏ß‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
                // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Sat Feb 07 2026...
                const longDateRegex = /[A-Z][a-z]{2}\s[A-Z][a-z]{2}\s\d{2}\s\d{4}/g;
                info = info.replace(longDateRegex, (match) => {
                    return moment(match).format('D MMM YY'); // ‡πÄ‡∏ä‡πà‡∏ô 7 ‡∏Å.‡∏û. 69
                });
                
                // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô (00:00:00 GMT...) ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á
                info = info.replace(/00:00:00 GMT\+0700 \(Indochina Time\)/g, '');

                const isSuccess = info.includes('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à') || info.includes('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢') || info.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß');
                const isActionable = (info.includes('‡∏£‡∏≠') || info.includes('‡∏Ç‡∏≠')) && !isSuccess;
                
                let theme = { icon: 'fa-bell', color: 'text-blue-500', bg: 'bg-blue-50' };
                if (info.includes('‡∏ã‡∏∑‡πâ‡∏≠') || info.includes('‡∏Ç‡∏≤‡∏¢')) theme = { icon: 'fa-money-bill-wave', color: 'text-emerald-500', bg: 'bg-emerald-50' };
                if (info.includes('‡πÅ‡∏•‡∏Å') || info.includes('‡∏™‡∏•‡∏±‡∏ö')) theme = { icon: 'fa-sync-alt', color: 'text-orange-500', bg: 'bg-orange-50' };
                if (isSuccess) theme.icon = 'fa-check-circle';

                const html = `
                <div class="card-enter bg-white rounded-2xl border p-4 shadow-sm mb-4 ${isActionable ? 'clickable-card border-indigo-500 bg-indigo-50/30' : 'border-slate-100'}" 
                    style="animation-delay: ${index * 0.05}s"
                    onclick="${isActionable ? `handleActionRedirect('${noti.info}')` : ''}">
                    <div class="flex gap-4">
                        <div class="w-12 h-12 rounded-2xl ${theme.bg} flex-shrink-0 flex items-center justify-center shadow-sm">
                            <i class="fas ${theme.icon} ${theme.color} text-lg"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-bold text-slate-800 text-sm truncate">${title}</h3>
                                <span class="text-[10px] text-slate-400 whitespace-nowrap bg-slate-50 px-2 py-1 rounded-lg">
                                    ${moment(noti.created_at).fromNow()}
                                </span>
                            </div>
                            <p class="text-xs text-slate-600 mb-3 leading-relaxed">${info}</p>
                            <div class="flex items-center justify-between pt-2 border-t border-slate-100/50">
                                <span class="text-[10px] text-slate-400 font-medium">‡πÇ‡∏î‡∏¢: ${noti.FirstName || '‡∏£‡∏∞‡∏ö‡∏ö'}</span>
                                ${isActionable ? `
                                    <span class="text-[10px] font-bold text-white bg-indigo-600 px-3 py-1 rounded-full shadow-md animate-pulse">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ <i class="fas fa-chevron-right ml-1"></i></span>
                                ` : `<span class="text-[10px] font-bold ${isSuccess ? 'text-emerald-500' : 'text-slate-300'}">${isSuccess ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' : '‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß'}</span>`}
                            </div>
                        </div>
                    </div>
                </div>`;
                list.insertAdjacentHTML('beforeend', html);
            });
        }

        async function fetchAdminPendingActions() {
            const token = localStorage.getItem('token');
            const container = document.getElementById('notificationList'); 
            try {
                const res = await fetch(`${API_URL}/api/admin/market/pending`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.success && data.results.length > 0) {
                    document.getElementById('emptyState').classList.add('hidden');
                    data.results.forEach(item => {
                        const cardHtml = `
                        <div id="admin-card-${item.TransactionID}" class="bg-white p-5 rounded-2xl border-2 border-indigo-100 shadow-sm mb-4 animate-item">
                            <div class="flex justify-between items-start mb-3">
                                <span class="bg-amber-100 text-amber-700 text-[10px] px-2 py-0.5 rounded-full font-bold uppercase">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</span>
                                <small class="text-slate-400 text-xs">${moment(item.CreatedAt).fromNow()}</small>
                            </div>
                            <div class="space-y-2 mb-4">
                                <p class="text-sm text-slate-700"><b>${item.SellerName}</b> ‡∏Ç‡∏≤‡∏¢‡πÄ‡∏ß‡∏£‡πÉ‡∏´‡πâ <b>${item.BuyerName}</b></p>
                                <p class="text-xs text-slate-500"><i class="far fa-calendar-alt mr-1"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏£: ${moment(item.ShiftDate).format('dddd‡∏ó‡∏µ‡πà D MMM YY')} (${item.ShiftName})</p>
                            </div>
                            <div id="admin-actions-${item.TransactionID}" class="flex gap-2">
                                <button onclick="adminAction(${item.TransactionID}, 'reject')" class="flex-1 px-4 py-2 rounded-xl border border-red-200 text-red-500 text-xs font-bold hover:bg-red-50 transition-all">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                                <button onclick="adminAction(${item.TransactionID}, 'approve')" class="flex-1 px-4 py-2 rounded-xl bg-indigo-600 text-white text-xs font-bold hover:bg-indigo-700 shadow-md transition-all active:scale-95">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏ß‡∏£</button>
                            </div>
                        </div>`;
                        container.insertAdjacentHTML('afterbegin', cardHtml);
                    });
                }
            } catch (err) { console.error("Fetch Admin Error:", err); }
        }

        async function adminAction(transactionId, action) {
            const token = localStorage.getItem('token');
            const confirm = await Swal.fire({
                title: action === 'approve' ? '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: action === 'approve' ? '#4f46e5' : '#ef4444'
            });

            if (!confirm.isConfirmed) return;

            try {
                const res = await fetch(`${API_URL}/api/admin/market/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ transactionId, action, adminId: currentUser.UserID })
                });

                const data = await res.json();
                if (data.success) {
                    const actionContainer = document.getElementById(`admin-actions-${transactionId}`);
                    if (actionContainer) {
                        actionContainer.innerHTML = `<div class="w-full text-center py-2 bg-emerald-50 text-emerald-600 rounded-xl font-bold text-xs animate-pulse"><i class="fas fa-check-circle mr-1"></i> ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>`;
                    }
                    const card = document.getElementById(`admin-card-${transactionId}`);
                    if (card) {
                        card.classList.replace('border-indigo-100', 'border-emerald-100');
                        card.style.opacity = '0.7';
                    }
                    Swal.fire({ icon: 'success', title: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 1000, showConfirmButton: false });
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)
                    setTimeout(loadNotifications, 1000);
                } else {
                    Swal.fire('Error', data.message, 'error');
                }
            } catch (err) { console.error(err); Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ', 'error'); }
        }

        function handleActionRedirect(info) {
            // ‡πÄ‡∏ä‡πá‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (info) ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Å‡πÅ‡∏Ñ‡πà Role ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            if (info.includes('‡∏ã‡∏∑‡πâ‡∏≠') || info.includes('‡∏Ç‡∏≤‡∏¢')) {
                window.location.href = 'trade_market.html';
            } 
            else if (info.includes('‡πÅ‡∏•‡∏Å') || info.includes('‡∏™‡∏•‡∏±‡∏ö')) {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ (RoleID 1) ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏ß‡∏£‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
                // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡πá‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö
                window.location.href = 'swap_request.html'; 
            }
            else {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                console.log("Normal notification, no redirect needed.");
            }
        }

        function filterNoti(type) {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn px-5 py-2 rounded-xl text-xs font-bold transition-all bg-white border border-slate-200 text-slate-600 shadow-sm';
            });
            event.target.className = 'filter-btn active px-5 py-2 rounded-xl text-xs font-bold transition-all bg-indigo-600 text-white shadow-md';
            
            if (type === 'all') renderList(allNotifications);
            else {
                const filtered = allNotifications.filter(n => {
                    const text = n.info.toLowerCase();
                    if (type === 'trade') return text.includes('‡∏ã‡∏∑‡πâ‡∏≠') || text.includes('‡∏Ç‡∏≤‡∏¢');
                    if (type === 'swap') return text.includes('‡πÅ‡∏•‡∏Å') || text.includes('‡∏™‡∏•‡∏±‡∏ö');
                    if (type === 'system') return !text.includes('‡∏ã‡∏∑‡πâ‡∏≠') && !text.includes('‡∏Ç‡∏≤‡∏¢') && !text.includes('‡πÅ‡∏•‡∏Å');
                    return true;
                });
                renderList(filtered);
            }
        }
    </script>
</body>
</html>